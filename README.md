# Система управления личными финансами
![Java](https://img.shields.io/badge/java-%23ED8B00.svg?style=for-the-badge&logo=openjdk&logoColor=white)
![Gradle](https://img.shields.io/badge/gradle-02303A?style=for-the-badge&logo=gradle&logoColor=white)
![Json](https://img.shields.io/badge/json-5E5C5C?style=for-the-badge&logo=json&logoColor=white)

![GitHub Actions](https://img.shields.io/badge/GitHub_Actions-2088FF?logo=github-actions&logoColor=white)
![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/yuyuvu/personal-budgeting-app/check-test-build.yml)

## Приложение предназначено для отслеживания личных финансов.
Оно позволяет:

1) Добавлять доходы и расходы по категориям.
2) Устанавливать бюджеты для отдельных категорий расходов.
3) Управлять категориями и бюджетами.
4) Выводить аналитику по ранее добавленным операциям.
5) Отслеживать перерасход и просматривать остаток возможных расходов
   по определённым категориям.
6) Выводить информацию с учётом фильтрации по категориям и периодам.
7) Выводить отсортированные списки всех добавленных операций.
8) Экспортировать и импортировать все или отдельные данные
   кошелька пользователя.
9) Учитывать переводы другим пользователям.
10) Сохранять отчёты по кошельку в файл.
11) Просматривать уведомления, которые выводятся в случае перерасхода
    бюджетов, наличия отрицательного баланса и при выполнении других
    условий.
12) Отключать и возвращать отображение уведомлений.
13) Авторизоваться в аккаунте и после выхода из аккаунта, и после полного
    перезапуска приложения с сохранением всех данных пользователя.
14) Регистрировать любое количество пользователей с разными данными.

## Помощь по приложению:

Приложение работает по принципу ввода цифровых команд в консоль.
Для получения доступа к требуемой пользователю функции нужно последовательно
пройти через ряд меню, вводя цифру интересующего пункта.
На каждом шаге работы приложения для пользователя выводятся подсказки,
что сейчас можно или нужно сделать.
Приложение проверяет ввод пользователя, и, в случае предоставления
некорректных значений для меню или параметров для функций, выводит
информативное сообщение об ошибке и повторяет запрос ввода.
Помимо ввода цифр или запрашиваемых параметров для отдельных функций,
на любом этапе работы приложения можно вводить служебные команды.

### Примеры использования:

1. Если имеющийся пользователь хочет сохранить в файл список всех
добавленных операций дохода, нужно последовательно ввести:
2 (вход в аккаунт) -> логин и пароль (по отображаемым подсказкам) ->
1 (меню базовой аналитики) -> 5 (меню расширенной аналитики) -> 3 (вывод
всех операций дохода) -> 2 (сохранить в файл) <br><br>

2. Если имеющийся пользователь хочет импортировать данные снимка состояния
заданных бюджетов по расходам:
2 (вход в аккаунт) -> логин и пароль (по отображаемым подсказкам) ->
4 (меню экспорта и импорта) -> 4 (экспорт / импорт бюджетов) ->
2 (импорт) -> да (подтвердить импорт) -> путь до снимка состояния. <br><br>

3. Пользователь находится в меню экспорта и хочет отключить приложение,
не возвращаясь в меню авторизации: для этого нужно ввести --off.

## Служебные команды приложения:
- --cancel - отмена текущего выбора и возврат в предыдущее меню;
- --help - вывод помощи по приложению;
- --hide_notifications - скрыть уведомления во всём приложении;
- --show_notifications - вернуть уведомления во всём приложении;
- --logout - выход из текущего аккаунта пользователя;
- --off - выключение приложения.

## Архитектура приложения:
Используется многослойная архитектура с элементами Domain Driven Design (DDD).
Классы разделены на слои:
- Infrastructure (пакет infrastructure): в нём содержится сервис DataPersistenceService,
  отвечающий за взаимодействие с файловой системой. Он сохраняет готовые к выгрузке данные в
  файлы либо наоборот загружает требуемые другим слоям данные из файлов. Также отвечает
  за сериализацию и десериализацию большинства данных.
- Application (пакет appservices): в нём содержатся сервисы, отвечающие за
  вспомогательную и служебную логику приложения. Они осуществляют регистрацию и
  авторизацию пользователей, хэширование паролей, управление настройками приложения,
  формируют и подготавливают к экспорту и к импорту содержимое снимков состояния 
  кошельков пользователей.
- Domain (пакеты domainservices и model): данные пакеты формируют основную логику приложения. 
  В данном слое содержатся основные сущности приложения (User и Wallet), они хранят в себе
  большую часть состояния, требуемого для работы приложения.
  Также к данному слою относятся сервисы для добавления доходов и расходов, установления бюджетов,
  совершения различных подсчётов по данным кошелька, фильтрации и агрегирования добавленных операций,
  редактирования добавленных категорий доходов, расходов и бюджетов. Помимо этого, в данный слой входят
  сервисы для формирования отчётов, которые могут быть выведены в консоль или сохранены в файл, 
  и для подготовки уведомлений по данным кошелька. 
- Presentation (пакеты presentation и вложенный menus): отвечает за вывод данных в консоль и запрос ввода
  от пользователя. Меню проводят валидацию введённых данных и направляют пользователя на функционал сервисов
  других слоёв.

Точка входа в приложение - класс Main, который запускает метод start класса PersonalBudgetingApp, отвечающего
за бесконечный цикл ввода / вывода.

## Дополнительные функции
Согласно ТЗ, во время работы приложение хранит все нужные ему данные в оперативной памяти, сохраняя их только при
выходе из аккаунта или выключении. Загружает данные из файлов только при авторизации и включении.

Реализована выгрузка отчётов в файлы, выгрузка и загрузка снимков состояния, фильтрация по категориям и периодам, 
расширенные уведомления, отключение / включение уведомлений, сохранение и загрузка кошельков из файла при выходе 
/ входе, валидация данных, редактирование категорий и бюджетов, подсказки при вводе, служебные команды,
команда help, хэширование паролей.

Приложение сохраняет своё состояние между перезапусками. Можно работать с прежними аккаунтами и данными 
после выключения и включения приложения.

Также добавлено автоформатирование (Spotless) и дополнительные проверки стиля кода 
(Checkstyle по google-java-format).

## Установка и запуск
Проект собирается при помощи Gradle и использует библиотеку Jackson для работы с Json.
Для сборки и запуска введите:
```bash
git clone https://github.com/yuyuvu/personal-budgeting-app.git
cd .\personal-budgeting-app
.\gradlew.bat build
cd .\build\libs
java -jar .\personal_budgeting_app-1.0.jar
```
Альтернативно можно скачать готовый jar файл из [релизов](https://github.com/yuyuvu/personal-budgeting-app/releases) и запустить его через:
```bash
java -jar .\personal_budgeting_app-1.0.jar
```

## Тестирование
В проект добавлено 42 интеграционных и юнит теста (src/test). Они покрывают более 50% кода и все слои, за исключением presentation.
Тестируется вся служебная и domain-логика приложения. Таким образом, не покрыта тестами только часть проверок вводимых
пользователем данных в меню.

Для быстрого ручного тестирования можно также использовать уже добавленного пользователя с именем newuser1 и паролем newuser1. 
В его кошелёк уже добавлены некоторые операции и бюджеты.
```bash
git clone https://github.com/yuyuvu/personal-budgeting-app.git
cd .\personal-budgeting-app
# Запуск тестов отдельно
.\gradlew.bat test
# Запуск тестов вместе со сборкой
.\gradlew.bat build
```

## CI
При каждом push или pull request в ветку main запускается пайплайн Github Actions, запускающий сборку через Gradle.
Применяется автоформатирование, проверяется стиль кода (Spotless, Checkstyle) и запускаются все тесты (JUnit).
